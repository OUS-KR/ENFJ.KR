<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 운세 - ENFJ</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <style>
        /* Custom styles are now handled by main.css through .info-card */
        .card-title .icon {
            display: inline-block;
            margin-right: 0.5em;
            font-style: normal;
        }
    </style>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">ENFJ.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links">
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">오늘의 콘텐츠</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/today-fortune/">오늘의 운세</a>
                        <a href="/u/tests/today-game/">오늘의 게임</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">정보</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/info-characteristics/">특징</a>
                        <a href="/u/tests/info-careers/">커리어</a>
                        <a href="/u/tests/info-cognitive-functions/">인지기능</a>
                        <a href="/u/tests/info-subtypes/">하위유형</a>
                        <a href="/u/tests/info-relationships/">인간관계</a>
                        <a href="/u/tests/info-misconceptions/">흔한 오해</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">테스트</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/test-logic-quiz/">ENFJ 공감 능력 퀴즈</a>
                        <a href="/u/tests/test-relationship-style/">연애 스타일 테스트</a>
                        <a href="/u/tests/test-stress-triggers/">스트레스 테스트</a>
                        <a href="/u/tests/test-brain-utilization/">ENFJ 리더십 스타일 테스트</a>
                        <a href="/u/tests/test-bingo/">빙고 챌린지</a>
                        <a href="/u/tests/test-empathy-quiz/">ENFJ 갈등 해결 퀴즈</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">게임</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/game-logic-puzzle/">ENFJ 협력 게임</a>
                        <a href="/u/tests/game-strategy-simulation/">ENFJ 사회적 전략 시뮬레이션</a>
                        <a href="/u/tests/game-code-decryption/">ENFJ 감정 해독 게임</a>
                        <a href="/u/tests/game-abstract-reasoning/">ENFJ 비전 공유 게임</a>
                        <a href="/u/tests/game-travel-planner/">ENFJ 팀 빌딩 챌린지</a>
                        <a href="/u/tests/game-maze-challenge/">ENFJ 관계 미로 탈출</a>
                        <a href="/u/tests/game-code-breaker/">ENFJ 소통 암호 해독</a>
                        <a href="/u/tests/game-pathfinder/">ENFJ 리더십 경로 탐색</a>
                    </div>
                </div>
            </nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>

    <div class="container">
        <h1>오늘의 ENFJ 운세</h1>
        <div id="fortuneContent">
            <div class="card info-card">
                <div class="card-title"><span class="icon">💡</span> 오늘의 조언</div>
                <p id="adviceDisplay">조언을 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📝</span> 오늘의 과제</div>
                <p id="taskDisplay">과제를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📈</span> INTP 지수</div>
                <p id="intpIndexDisplay">INTP 지수를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">🔑</span> 행운의 키워드</div>
                <p id="keywordDisplay">키워드를 불러오는 중...</p>
            </div>
        </div>
    </div>

    <script src="/assets/js/main.js" defer></script>
    <script>
    function getDailySeed() {
        const today = new Date();
        return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
    }

    function mulberry32(seed) {
        return function() {
            seed |= 0;
            seed = seed + 0x6D2B79F5 | 0;
            let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
            t = t + Math.imul(t ^ t >>> 7, 61 | t) | 0;
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    /**
     * 한국어 조사(e.g., 은/는, 을/를)를 앞 단어의 받침 유무에 따라 올바르게 선택하는 함수
     * @param {string} text - 조사가 붙을 단어
     * @param {string} particle - '/'로 구분된 조사 쌍 (예: "을/를")
     * @returns {string} - 선택된 조사
     */
    function josa(text, particle) {
        const particles = particle.split('/');
        if (particles.length < 2) return particle;

        if (typeof text !== 'string' || text.length === 0) return particles[1];
        const lastChar = text[text.length - 1];
        const charCode = lastChar.charCodeAt(0);

        // 한글 (가-힣) 범위 체크
        if (charCode < 0xAC00 || charCode > 0xD7A3) {
            // 한글이 아니면 기본값(받침 없는 경우) 반환
            return particles[1];
        }

        const hasBatchim = (charCode - 0xAC00) % 28 > 0;
        return hasBatchim ? particles[0] : particles[1];
    }

    // --- Enhanced Generative Data Parts ---
    const data = {
        advice: {
            openings: ["오늘은", "오늘 당신의", "지금은", "오늘은 특별히"],
            subjects: ["타인과의 공감 능력이", "영감을 주는 리더십이", "따뜻한 영향력이", "사람들을 돕고자 하는 마음이", "긍정적인 변화를 만들려는 의지가", "조화로운 관계를 구축하는 능력이"],
            verbs: ["빛을 발하는 날입니다.", "새로운 기회를 가져올 것입니다.", "주변에 긍정적인 에너지를 전파합니다.", "당신을 중심으로 사람들을 모을 것입니다.", "의미 있는 성과로 이어질 것입니다."],
            connectors: ["따라서", "그러니", "이 기회를 빌어", "망설이지 말고"],
            actions: ["주변 사람들에게 먼저 다가가 진심을 표현해 보세요.", "당신의 비전을 공유하고 함께할 사람들을 독려해 보세요.", "갈등 상황에서 중재자 역할을 자처해 보세요.", "누군가의 고민을 들어주고 진심 어린 조언을 건네보세요.", "당신의 열정으로 주변을 밝히는 활동에 참여해 보세요.", "팀원들의 강점을 파악하고 시너지를 이끌어내 보세요."]
        },
        task: {
            types: ["계획하기:", "조직하기:", "소통하기:", "영향주기:"],
            actions: ["오랫동안 미뤄왔던", "새롭게 시도하고 싶은", "주변 사람들과 함께할", "개선이 필요하다고 생각하는"],
            subjects: ["모임이나 행사", "봉사 활동", "팀 프로젝트", "사회적 이슈", "개인적인 목표", "관계 개선 방안"],
            verbs: ["을(를) 위한 구체적인 계획을 세워보세요.", "의 역할을 분담하고 실행 계획을 세워보세요.", "에 대해 긍정적인 메시지를 전달해 보세요.", "과/와 관련된 사람들의 의견을 경청하고 조율해 보세요.", "의 성공을 위해 필요한 자원을 연결해 보세요."]
        },
        enfjIndex: { // Changed from intpIndex
            reasons: ["타인과의 깊은 유대감이 형성되어", "영감을 주는 리더십이 발휘되어", "긍정적인 영향력이 주변에 확산되어", "사람들의 마음을 움직이는 공감 능력이 최고조에 달해", "조화로운 관계 속에서 시너지가 창출되어"],
            results: ["사회적 성취감이 극대화됩니다.", "새로운 협력 관계를 구축할 가능성이 높습니다.", "주변 사람들에게 큰 지지와 존경을 받을 수 있습니다.", "의미 있는 변화를 이끌어낼 수 있습니다."]
        },
        keywords: ["공감", "리더십", "조화", "영감", "소통", "사회적", "영향력", "멘토", "옹호자", "공동체", "비전", "열정", "연결", "관계", "협력", "동기부여", "설득", "표현", "지지", "성장"]
    };

    // --- Generator Functions ---
    function generateAdvice(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const structureType = randFn();
        if (structureType < 0.4) {
            // Structure 1: Subject + Verb
            return `${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else if (structureType < 0.8) {
            // Structure 2: Opening + Subject + Verb
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else {
            // Structure 3: Full Sentence
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)} ${pick(parts.connectors)} ${pick(parts.actions)}`;
        }
    }

    function generateTask(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const type = pick(parts.types);
        const action = pick(parts.actions);
        const subject = pick(parts.subjects);
        const verb = pick(parts.verbs);

        // 문장 조합: action + subject + verb
        let rawSentence = `${action} ${subject}${verb}`;

        // 조사 처리
        rawSentence = rawSentence
            .replace("을(를)", josa(subject, "을/를"))
            .replace("은(는)", josa(subject, "은/는"))
            .replace("이(가)", josa(subject, "이/가"))
            .replace("과/와", josa(subject, "과/와"));

        return `${type} ${rawSentence}`;
    }

    function generateIntpIndex(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        const percentage = 65 + Math.floor(randFn() * 31); // 65% to 95%
        return `${percentage}% - ${pick(parts.reasons)} ${pick(parts.results)}`;
    }

    function generateKeywords(randFn, keywords, count) {
        const shuffled = [...keywords].sort(() => randFn() - 0.5);
        return shuffled.slice(0, count).map(k => `#${k}`).join(" ");
    }

    // --- Main Execution ---
    window.onload = function() {
        try {
            const seed = getDailySeed();
            const randFn = mulberry32(seed);

            document.getElementById('adviceDisplay').innerText = generateAdvice(randFn, data.advice);
            document.getElementById('taskDisplay').innerText = generateTask(randFn, data.task);
            document.getElementById('intpIndexDisplay').innerText = generateIntpIndex(randFn, data.intpIndex);
            document.getElementById('keywordDisplay').innerText = generateKeywords(randFn, data.keywords, 5);
        } catch (e) {
            console.error("오늘의 운세 생성 중 오류 발생:", e);
            document.getElementById('adviceDisplay').innerText = "콘텐츠를 불러오는 데 실패했습니다. 페이지를 새로고침해 주세요.";
        }
    };
</script>
</body>
</html>